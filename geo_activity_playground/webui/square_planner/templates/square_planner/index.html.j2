{% extends "page.html.j2" %}

{% block container %}
<div class="row mb-3">
    <div class="col">
        <h1>Square Planner</h1>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-3">
        <table class="mb-3">
            <tr>
                <td>
                    <a class="btn btn-primary"
                        href="/square-planner/{{ zoom }}/{{ square_x-1 }}/{{ square_y-1 }}/{{ square_size+1 }}">↖</a>
                    <a class="btn btn-primary"
                        href="/square-planner/{{ zoom }}/{{ square_x+1 }}/{{ square_y+1 }}/{{ square_size-1 }}">↘</a>
                </td>
                <td></td>
                <td>
                    <a class="btn btn-primary"
                        href="/square-planner/{{ zoom }}/{{ square_x }}/{{ square_y+1 }}/{{ square_size-1 }}">↙</a>
                    <a class="btn btn-primary"
                        href="/square-planner/{{ zoom }}/{{ square_x }}/{{ square_y-1 }}/{{ square_size+1 }}">↗</a>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <table>
                        <tr>
                            <td>
                                <a class="btn btn-primary"
                                    href="/square-planner/{{ zoom }}/{{ square_x-1 }}/{{ square_y-1 }}/{{ square_size }}">↖</a>
                            </td>
                            <td>
                                <a class="btn btn-primary"
                                    href="/square-planner/{{ zoom }}/{{ square_x }}/{{ square_y-1 }}/{{ square_size }}">↑</a>
                            </td>
                            <td>
                                <a class="btn btn-primary"
                                    href="/square-planner/{{ zoom }}/{{ square_x+1 }}/{{ square_y-1 }}/{{ square_size }}">↗</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <a class="btn btn-primary"
                                    href="/square-planner/{{ zoom }}/{{ square_x-1 }}/{{ square_y }}/{{ square_size }}">←</a>
                            </td>
                            <td></td>
                            <td>
                                <a class="btn btn-primary"
                                    href="/square-planner/{{ zoom }}/{{ square_x+1 }}/{{ square_y }}/{{ square_size }}">→</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <a class="btn btn-primary"
                                    href="/square-planner/{{ zoom }}/{{ square_x-1 }}/{{ square_y+1 }}/{{ square_size }}">↙</a>
                            </td>
                            <td>
                                <a class="btn btn-primary"
                                    href="/square-planner/{{ zoom }}/{{ square_x }}/{{ square_y+1 }}/{{ square_size }}">↓</a>
                            </td>
                            <td>
                                <a class="btn btn-primary"
                                    href="/square-planner/{{ zoom }}/{{ square_x+1 }}/{{ square_y+1 }}/{{ square_size }}">↘</a>
                            </td>
                        </tr>
                    </table>
                </td>
                <td></td>
            </tr>
            <tr>
                <td>
                    <a class="btn btn-primary"
                        href="/square-planner/{{ zoom }}/{{ square_x-1 }}/{{ square_y }}/{{ square_size+1 }}">↙</a>
                    <a class="btn btn-primary"
                        href="/square-planner/{{ zoom }}/{{ square_x+1 }}/{{ square_y }}/{{ square_size-1 }}">↗</a>
                </td>
                <td></td>
                <td>
                    <a class="btn btn-primary"
                        href="/square-planner/{{ zoom }}/{{ square_x }}/{{ square_y }}/{{ square_size-1 }}">↖</a>
                    <a class="btn btn-primary"
                        href="/square-planner/{{ zoom }}/{{ square_x }}/{{ square_y }}/{{ square_size+1 }}">↘</a>
                </td>
            </tr>
        </table>

        <p>Download missing tiles as <a
                href="/square-planner/{{ zoom }}/{{ square_x }}/{{ square_y }}/{{ square_size }}/missing.geojson">GeoJSON</a>
            or <a href="/square-planner/{{ zoom }}/{{ square_x }}/{{ square_y }}/{{ square_size }}/missing.gpx">GPX</a>.
        </p>
    </div>
    <div class="col-md-9">
        <div id="explorer-map" class="mb-3" style="height: 600px;"></div>

        <script>
            let map = L.map('explorer-map', {
                fullscreenControl: true,
                center: [0.0, 0.0],
                zoom: 14
            })

            L.tileLayer('/tile/grayscale/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href=" http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map)

            let explorer_geojson = {{ explored_geojson| safe }}
            let explorer_layer_cluster_color = L.geoJSON(explorer_geojson, {
                style: function (feature) {
                    return {
                        color: "#4daf4a", fillColor: "#4daf4a",
                        weight: 0.5
                    }
                }
            }).addTo(map)

            let missing_geojson = {{ missing_geojson| safe }}
            let missing_layer_cluster_color = L.geoJSON(missing_geojson, {
                style: function (feature) {
                    return {
                        color: "#e41a1c", fillColor: "#e41a1c",
                        weight: 0.5
                    }
                }
            }).addTo(map)

            let square_geojson = {{ square_geojson | safe }}
            let explorer_square_layer = L.geoJSON(square_geojson,
                {
                    style: function (feature) {
                        return {
                            color: "blue", fill: false, weight: 2
                        }
                    }
                }
            ).addTo(map)

            map.fitBounds(explorer_square_layer.getBounds())
        </script>
    </div>
</div>

<p class="mb-3">This feature was developed in memory of Natenom who unfortunately didn't live to enjoy it for more tile
    exploring.</p>

{% endblock %}