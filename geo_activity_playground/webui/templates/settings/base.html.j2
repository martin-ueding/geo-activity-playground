{% extends "page.html.j2" %}

{# Navigation structure for settings pages #}
{% set settings_nav = [
    {
        "group": _("Data Sources"),
        "entries": [
            {"endpoint": "settings.strava", "label": _("Strava API"), "icon": "ğŸ”—"},
            {"endpoint": "settings.metadata_extraction", "label": _("Metadata Extraction"), "icon": "ğŸ“"},
        ]
    },
    {
        "group": _("Display"),
        "entries": [
            {"endpoint": "settings.color_schemes", "label": _("Color Schemes"), "icon": "ğŸ¨"},
            {"endpoint": "settings.color_strategy", "label": _("Color Strategy"), "icon": "ğŸ—ºï¸"},
            {"endpoint": "settings.tile_source", "label": _("Map Tile Source"), "icon": "ğŸ§­"},
            {"endpoint": "settings.language", "label": _("Language"), "icon": "ğŸŒ"},
        ]
    },
    {
        "group": _("Analysis"),
        "entries": [
            {"endpoint": "settings.segmentation", "label": _("Track Segmentation"), "icon": "âœ‚ï¸"},
            {"endpoint": "plot_builder.index", "label": _("Plot Builder"), "icon": "ğŸ“Š"},
        ]
    },
    {
        "group": _("Personal"),
        "entries": [
            {"endpoint": "settings.heart_rate", "label": _("Heart Rate"), "icon": "â¤ï¸"},
        ]
    },
    {
        "group": _("Management"),
        "entries": [
            {"endpoint": "settings.manage_equipments", "label": _("Equipment"), "icon": "ğŸš²"},
            {"endpoint": "settings.manage_kinds", "label": _("Activity Kinds"), "icon": "ğŸƒ"},
            {"endpoint": "settings.tags_list", "label": _("Tags"), "icon": "ğŸ·ï¸"},
        ]
    },
    {
        "group": _("Privacy & Security"),
        "entries": [
            {"endpoint": "settings.privacy_zones", "label": _("Privacy Zones"), "icon": "ğŸ”’"},
            {"endpoint": "settings.sharepic", "label": _("Share Picture"), "icon": "ğŸ“·"},
            {"endpoint": "settings.admin_password", "label": _("Admin Password"), "icon": "ğŸ”‘"},
        ]
    },
] %}

{# Helper macro to check if current page is within a nav item's scope #}
{% macro is_active(endpoint) %}
    {%- set current = request.endpoint -%}
    {%- if current == endpoint -%}
        active
    {%- elif endpoint == 'settings.tags_list' and current in ['settings.tags_list', 'settings.tags_new', 'settings.tags_edit'] -%}
        active
    {%- elif endpoint == 'settings.manage_kinds' and current in ['settings.manage_kinds', 'settings.kinds_new', 'settings.kinds_edit', 'settings.kinds_delete'] -%}
        active
    {%- elif endpoint == 'plot_builder.index' and current and current.startswith('plot_builder.') -%}
        active
    {%- endif -%}
{% endmacro %}

{% block container %}
<div class="row">
    {# Breadcrumbs #}
    <div class="col-12 mb-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{{ url_for('settings.index') }}">{{ _('Settings') }}</a></li>
                {% block breadcrumbs %}{% endblock %}
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    {# Sidebar Navigation #}
    <div class="col-lg-3 col-md-4 mb-4">
        <div class="d-md-none mb-3">
            <button class="btn btn-outline-secondary w-100" type="button" data-bs-toggle="collapse" 
                    data-bs-target="#settingsNav" aria-expanded="false" aria-controls="settingsNav">
                â˜° {{ _('Settings Menu') }}
            </button>
        </div>
        
        <nav id="settingsNav" class="collapse d-md-block bg-body-tertiary rounded p-3">
            {% for group in settings_nav %}
            <h6 class="text-body-secondary text-uppercase small fw-bold mb-2 {% if not loop.first %}mt-3{% endif %}">
                {{ group.group }}
            </h6>
            <ul class="nav nav-pills flex-column mb-2">
                {% for item in group.entries %}
                <li class="nav-item">
                    <a class="nav-link py-1 px-2 {{ is_active(item.endpoint) }}" 
                       href="{{ url_for(item.endpoint) }}"
                       {% if is_active(item.endpoint) %}aria-current="page"{% endif %}>
                        <span class="me-2">{{ item.icon }}</span>{{ item.label }}
                    </a>
                </li>
                {% endfor %}
            </ul>
            {% endfor %}
        </nav>
    </div>
    
    {# Main Content Area #}
    <div class="col-lg-9 col-md-8">
        {% block settings_content %}{% endblock %}
    </div>
</div>
{% endblock %}
